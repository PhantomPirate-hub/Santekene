# üìò **Guide d'Installation - Sant√© K√®n√®**

## **üìã Table des mati√®res**
1. [Pr√©requis](#pr√©requis)
2. [Installation Backend](#installation-backend)
3. [Installation Frontend](#installation-frontend)
4. [Configuration Base de donn√©es](#configuration-base-de-donn√©es)
5. [Configuration Hedera](#configuration-hedera)
6. [Installation Backend IA](#ü§ñ-installation-backend-ia)
7. [D√©marrage de l'application](#d√©marrage-de-lapplication)
8. [V√©rifications](#v√©rifications)
9. [D√©pannage](#d√©pannage)

---

## **üîß Pr√©requis**

### **Logiciels requis**
- **Node.js** : v18.0.0 ou sup√©rieur
- **npm** : v9.0.0 ou sup√©rieur
- **MySQL** : v8.0 ou sup√©rieur
- **Git** : pour cloner le projet
- **Docker** : pour Redis
- **Python** : v3.8 ou sup√©rieur

### **V√©rifier les versions**
```bash
node --version    # v18.0.0+
npm --version     # v9.0.0+
mysql --version   # 8.0+
git --version
python --version  # v3.8+
```

---

## **üì¶ Installation Backend**

### **1. Cloner le projet**
```bash
git clone https://github.com/PhantomPirate-hub/Santekene
cd Santekene/backend-api
```

### **2. Installer les d√©pendances**
```bash
npm install
```

### **3. Cr√©er le fichier `.env`**
Cr√©ez un fichier `.env` √† la racine de `backend-api/` :

```env
# Database
DATABASE_URL="mysql://root:votre_mot_de_passe@localhost:3306/santekene"

# JWT
JWT_SECRET="votre_secret_jwt_tres_long_et_securise"
JWT_EXPIRES_IN="7d"

# Server
PORT=3001
NODE_ENV=development
FRONTEND_URL=http://localhost:3000

# Hedera Configuration (Testnet)

HEDERA_NETWORK=testnet
HEDERA_ACCOUNT_ID=0.0.XXXXXXX
HEDERA_PRIVATE_KEY=302e020100300506032b657004220420...
HEDERA_HCS_TOPIC_ID=0.0.XXXXXXX
# Variables pour HCS/HTS/HFS Services (alias)
HEDERA_OPERATOR_ID=0.0.XXXXXXX
HEDERA_OPERATOR_KEY=302e020100300506032b657004220420...
HEDERA_TOPIC_ID=0.0.XXXXXXX
HEDERA_TOKEN_ID=0.0.XXXXXXX

# Redis (pour Hedera queues)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# Storage
USE_MINIO=false
LOCAL_STORAGE_PATH=./uploads
```

### **4. Configurer la base de donn√©es**

#### **Cr√©er la base de donn√©es MySQL**
```sql
CREATE DATABASE santekene CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

#### **Lancer les migrations Prisma**
```bash
npx prisma migrate dev
```

#### **G√©n√©rer le client Prisma**
```bash
npx prisma generate
```

#### **Cr√©er le SuperAdmin (seed)**
```bash
npx prisma db seed
```

**Compte SuperAdmin par d√©faut** :
- Email : `superadmin@santekene.com`
- Mot de passe : `SuperAdmin2024!`

---

## **üé® Installation Frontend**

### **1. Aller dans le dossier frontend**
```bash
cd ../frontend
```

### **2. Installer les d√©pendances**
```bash
npm install
```

### **3. Cr√©er le fichier `.env.local`**
Cr√©ez un fichier `.env.local` √† la racine de `frontend/` :

```env
NEXT_PUBLIC_API_URL=http://localhost:3001
NEXT_PUBLIC_BACKEND_URL=http://localhost:3001
```

---

## **üóÑÔ∏è Configuration Base de donn√©es**

### **Structure de la base de donn√©es**

L'application utilise **Prisma ORM** avec **MySQL**. Le sch√©ma complet est dans `backend-api/prisma/schema.prisma`.

### **Mod√®les principaux**

1. **User** : Utilisateurs (patients, m√©decins, admins, superadmin)
2. **Patient** : Profil patient (groupe sanguin, allergies, etc.)
3. **Doctor** : Profil m√©decin (sp√©cialit√©, structure, etc.)
4. **Consultation** : Consultations m√©dicales
5. **Document** : Documents m√©dicaux (analyses, radios, etc.)
6. **Prescription** : Ordonnances
7. **Appointment** : Rendez-vous
8. **DseAccessRequest** : Demandes d'acc√®s au DSE
9. **CommunityPost** : Posts de la communaut√©
10. **CommunityCategory** : Cat√©gories de posts
11. **UserWallet** : Portefeuille KenePoints
12. **WalletTransaction** : Historique des transactions KNP

### **Champs sp√©cifiques Hedera**

Certains mod√®les ont des champs pour l'int√©gration Hedera :
- `blockchainTxId` : ID de transaction Hedera
- `hfsFileId` : ID du fichier sur Hedera File Service (HFS)
- `hfsHash` : Hash SHA-256 pour v√©rification d'int√©grit√©

---

## **üåê Configuration Hedera**

### **1. Cr√©er un compte Hedera Testnet**

1. Aller sur : https://portal.hedera.com
2. S'inscrire et cr√©er un compte
3. R√©cup√©rer :
   - **Account ID** (ex: `0.0.7148888`)
   - **Private Key** (format DER : `302e020100...`)

### **2. Obtenir des HBAR Testnet**

1. Aller sur : https://portal.hedera.com/faucet
2. Entrer votre Account ID
3. Recevoir 10,000 HBAR testnet (gratuit)

### **3. Cr√©er le Topic HCS**

```bash
cd backend-api
node src/scripts/create-hcs-topic.ts
```

**R√©sultat attendu** :
```
‚úÖ Topic HCS cr√©√© avec succ√®s !
   Topic ID: 0.0.XXXXXXX
   M√©mo: Santekene - Medical Data Audit Trail
```

Ajoutez ce Topic ID dans votre `.env` :
```env
HEDERA_HCS_TOPIC_ID=0.0.XXXXXXX
HEDERA_TOPIC_ID=0.0.XXXXXXX
```

### **4. Cr√©er le Token KenePoints**

```bash
node src/scripts/create-kenepoint-token.ts
```

**R√©sultat attendu** :
```
‚úÖ Token KenePoints cr√©√© avec succ√®s !
   Token ID: 0.0.XXXXXXX
   Supply: 10,000,000 KNP
```

Ajoutez ce Token ID dans votre `.env` :
```env
HEDERA_TOKEN_ID=0.0.XXXXXXX
```

### **5. D√©marrer Redis (pour Hedera queues)**

#### **Avec Docker (recommand√©)** :
```bash
docker run -d --name redis -p 6379:6379 redis:latest
```

#### **Sans Docker** :
Installez Redis localement selon votre syst√®me d'exploitation.

---

## **ü§ñ Installation Backend IA**

L'application int√®gre un **backend IA s√©par√©** (Python/FastAPI) pour l'analyse des sympt√¥mes et les recommandations m√©dicales.

### **1. Pr√©requis**

- **Python** : v3.8 ou sup√©rieur
- **pip** : Gestionnaire de paquets Python
- **Compte Groq** : Gratuit, pour acc√©der √† l'API Groq

### **2. Installation**

#### **Installer Python (si n√©cessaire)**

**Windows** :
- T√©l√©charger depuis : https://www.python.org/downloads/
- Cochez "Add Python to PATH" lors de l'installation

**Linux/Mac** :
```bash
python3 --version  # V√©rifier la version
```

#### **Installer les d√©pendances**

```bash
cd backend-ai
python -m pip install -r requirements.txt
```

### **3. Configuration**

#### **Obtenir une cl√© Groq (GRATUIT)**

1. Aller sur : https://console.groq.com/keys
2. Cr√©er un compte gratuit
3. G√©n√©rer une cl√© API
4. Copier la cl√©

#### **Cr√©er le fichier `.env`**

Cr√©ez un fichier `.env` √† la racine de `backend-ai/` :

```env
GROQ_API_KEY=votre_cle_groq_ici
BACKEND_URL=http://localhost:3001
```

**‚ö†Ô∏è Important** : Remplacez `votre_cle_groq_ici` par votre vraie cl√© Groq.

### **4. D√©marrer le Backend IA**

```bash
cd backend-ai
python -m uvicorn main:app --reload --port 8000
```

**Terminal devrait afficher** :
```
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process
INFO:     Started server process
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

### **5. V√©rifier l'installation**

Ouvrez votre navigateur :
```
http://localhost:8000/docs
```

Vous devriez voir la **documentation Swagger/OpenAPI** du Backend IA avec tous les endpoints disponibles.

---

## **üöÄ D√©marrage de l'application**

### **1. D√©marrer le backend**

```bash
cd backend-api
npm run dev
```

**Terminal devrait afficher** :
```
‚úÖ Service HCS initialis√©
   Operator ID: 0.0.XXXXXXX
   Topic ID: 0.0.XXXXXXX

‚úÖ Service HFS initialis√©
   Operator ID: 0.0.XXXXXXX

‚úÖ Service HTS initialis√©
   Token ID: 0.0.XXXXXXX

üöÄ Serveur backend d√©marr√© sur http://localhost:3001
```

### **2. D√©marrer le Backend IA** *(Optionnel - si install√©)*

**Dans un nouveau terminal** :
```bash
cd backend-ai
python -m uvicorn main:app --reload --port 8000
```

### **3. D√©marrer le frontend**

**Dans un nouveau terminal** :
```bash
cd frontend
npm run dev
```

**Terminal devrait afficher** :
```
‚úì Ready in 2.5s
‚óã Local:   http://localhost:3000
```

### **4. Acc√©der √† l'application**

Ouvrez votre navigateur :
```
http://localhost:3000
```

---

## **‚úÖ V√©rifications**


### **1. V√©rifier la base de donn√©es**

```sql
-- V√©rifier le SuperAdmin
SELECT id, name, email, role FROM User WHERE role = 'SUPERADMIN';

-- V√©rifier les tables
SHOW TABLES;
```

### **2. V√©rifier le Backend IA** *(si install√©)*

Ouvrir dans le navigateur :
```
http://localhost:8000/docs
```

**Attendu** : Page Swagger/OpenAPI de l'API IA

### **3. Se connecter au frontend**

1. Aller sur `http://localhost:3000/login`
2. Se connecter avec le SuperAdmin :
   - Email : `superadmin@santekene.com`
   - Mot de passe : `SuperAdmin2024!`
3. Vous devriez √™tre redirig√© vers `/dashboard/superadmin`

### **4. Tester l'IA Clinique** *(si Backend IA install√©)*

1. Se connecter en tant que patient
2. Aller sur **IA Clinique** (menu)
3. Saisir des sympt√¥mes (texte ou vocal)
4. **Attendu** : Analyse IA + recommandations m√©decins/centres de sant√©

---

## **üîç V√©rifier l'int√©gration Hedera**

### **1. Voir vos ressources Hedera**

**R√©sultat** :
```
üîó VOS LIENS HASHSCAN (TESTNET)

üìç COMPTE PRINCIPAL:
   https://hashscan.io/testnet/account/0.0.XXXXXXX

üìú TOPIC HCS (Audit Trail):
   https://hashscan.io/testnet/topic/0.0.XXXXXXX

üí∞ TOKEN KENEPOINTS:
   https://hashscan.io/testnet/token/0.0.XXXXXXX
```

### **2. Uploader un document et v√©rifier HFS**

1. Se connecter comme m√©decin
2. Acc√©der au DSE d'un patient
3. Cr√©er une consultation
4. Uploader un document (PDF ou image)

**Logs backend attendus** :
```
‚úÖ Document cr√©√© dans DB: ID X
‚úÖ Fichier HFS cr√©√©: 0.0.XXXXXXX
   Hash: abc123...
   Taille: XXXXX bytes
‚úÖ Document X upload√© sur HFS: 0.0.XXXXXXX
üì§ Message HCS envoy√© pour document X
‚úÖ R√©compense de 20 KNP attribu√©e
```

**V√©rifier sur HashScan** :
- Aller sur votre compte : `https://hashscan.io/testnet/account/0.0.XXXXXXX`
- Chercher une transaction **FILE CREATE** (upload HFS)
- Chercher des messages sur le Topic (audit HCS)

---

## **‚ùå D√©pannage**

### **Probl√®me 1 : Erreur de connexion MySQL**

**Erreur** :
```
Error: P1001: Can't reach database server
```

**Solution** :
1. V√©rifier que MySQL est d√©marr√©
2. V√©rifier le `DATABASE_URL` dans `.env`
3. Tester la connexion :
```bash
mysql -u root -p
```

### **Probl√®me 2 : Port 3001 d√©j√† utilis√©**

**Erreur** :
```
Error: listen EADDRINUSE: address already in use :::3001
```

**Solution** :
1. Changer le port dans `.env` :
```env
PORT=3002
```
2. Red√©marrer le backend

### **Probl√®me 3 : Services Hedera non disponibles**

**Logs** :
```
‚ö†Ô∏è  HCS non configur√©
‚ö†Ô∏è  HFS non disponible
```

**Solution** :
1. V√©rifier les variables Hedera dans `.env` :
```env
HEDERA_OPERATOR_ID=0.0.XXXXXXX
HEDERA_OPERATOR_KEY=302e020100...
HEDERA_TOPIC_ID=0.0.XXXXXXX
```

**‚ö†Ô∏è Important** : Pas de guillemets autour des valeurs !

2. V√©rifier que Redis tourne (pour les queues) :
```bash
docker ps | grep redis
```

### **Probl√®me 4 : Erreur Prisma EPERM**

**Erreur** :
```
EPERM: operation not permitted
```

**Solution** :
1. Arr√™ter le backend (Ctrl+C)
2. G√©n√©rer le client :
```bash
npx prisma generate
```
3. Red√©marrer :
```bash
npm run dev
```

### **Probl√®me 5 : Migration Prisma √©choue**

**Erreur** :
```
Could not find migration file
```

**Solution** :
1. Supprimer les dossiers de migration vides dans `prisma/migrations/`
2. Relancer :
```bash
npx prisma migrate dev
```

### **Probl√®me 6 : Backend IA ne d√©marre pas**

**Erreur** :
```
ModuleNotFoundError: No module named 'fastapi'
```

**Solution** :
1. V√©rifier que Python est install√© :
```bash
python --version
```
2. R√©installer les d√©pendances :
```bash
cd backend-ai
python -m pip install -r requirements.txt
```

### **Probl√®me 7 : Erreur Groq API**

**Erreur** :
```
Error: Invalid API key
```

**Solution** :
1. V√©rifier que `GROQ_API_KEY` est d√©fini dans `backend-ai/.env`
2. Obtenir une nouvelle cl√© sur : https://console.groq.com/keys
3. Red√©marrer le Backend IA

### **Probl√®me 8 : Port 8000 d√©j√† utilis√©**

**Erreur** :
```
Error: listen EADDRINUSE: address already in use :::8000
```

**Solution** :
1. Changer le port lors du d√©marrage :
```bash
python -m uvicorn main:app --reload --port 8001
```
2. Mettre √† jour `NEXT_PUBLIC_AI_API_URL` dans `frontend/.env.local` :
```env
NEXT_PUBLIC_AI_API_URL=http://localhost:8001
```

---

## **ü§ñ Fonctionnalit√©s Backend IA**

### **Fonctionnalit√©s IA**

#### **1. Triage IA des sympt√¥mes** ü©∫
- **Saisie texte** : Description manuelle des sympt√¥mes
- **Saisie vocale** : Transcription automatique (speech-to-text)
- **Analyse IA** : √âvaluation de la gravit√© et recommandations
- **R√©sultats** :
  - Niveau de gravit√© (faible, moyen, √©lev√©, urgent)
  - Diagnostic probable
  - Recommandations d'action
  - Sp√©cialit√©s m√©dicales sugg√©r√©es

#### **2. Recommandations intelligentes** üí°
- **M√©decins recommand√©s** : Bas√©s sur les sympt√¥mes et sp√©cialit√©s
- **Centres de sant√© √† proximit√©** : G√©olocalisation + calcul de distance (formule Haversine)
- **Tri par pertinence** : Distance, disponibilit√©, sp√©cialit√©

### **Architecture IA**

```
Frontend (Next.js)
    ‚Üì
Backend IA (FastAPI - Port 8000)
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚Ä¢ Analyse sympt√¥mes (NLP)      ‚îÇ
‚îÇ  ‚Ä¢ Transcription audio           ‚îÇ
‚îÇ  ‚Ä¢ Recommandations m√©dicales     ‚îÇ
‚îÇ  ‚Ä¢ G√©olocalisation              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
Backend API (Express - Port 3001)
    ‚Üì
Base de donn√©es MySQL
```

### **API Endpoints IA**

| Endpoint | M√©thode | Description |
|----------|---------|-------------|
| `/api/ai/triage` | POST | Analyse des sympt√¥mes |
| `/api/ai/transcribe` | POST | Transcription audio ‚Üí texte |
| `/api/ai/recommend-doctors` | GET | Recommandations m√©decins |
| `/api/ai/recommend-health-centers` | GET | Centres de sant√© proches |


### **Technologies IA utilis√©es**

- **FastAPI** : Framework web Python haute performance
- **Groq API** : Llama 3.3 70B pour analyse m√©dicale ultra-rapide (gratuit)
- **G√©olocalisation** : Formule de Haversine pour calcul de distance
- **NLP** : Traitement du langage naturel pour extraction de sympt√¥mes

### **S√©curit√© IA**

- ‚úÖ Aucune donn√©e m√©dicale sensible envoy√©e au cloud
- ‚úÖ Analyse uniquement des sympt√¥mes (anonymis√©s)
- ‚úÖ Pas de stockage des conversations
- ‚úÖ Recommandations √† titre informatif (non-diagnostic m√©dical)
- ‚ö†Ô∏è **Disclaimer** : L'IA ne remplace pas un avis m√©dical professionnel

---

## **üìä Structure du projet**

```
Santekene/
‚îú‚îÄ‚îÄ backend-api/
‚îÇ   ‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma          # Sch√©ma de base de donn√©es
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrations/            # Historique des migrations
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ seed.ts                # Seed SuperAdmin
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/           # Logique m√©tier
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/                # Routes API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/            # Authentification, RBAC, etc.
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/              # Services (Hedera, Email, etc.)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/                 # Types TypeScript
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ workers/               # Workers Hedera (HCS, HFS)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ server.ts              # Serveur Express
‚îÇ   ‚îú‚îÄ‚îÄ uploads/                   # Fichiers upload√©s
‚îÇ   ‚îú‚îÄ‚îÄ .env                       # Variables d'environnement
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/                   # Pages Next.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/            # Composants React
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ context/               # Context API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/                 # Custom hooks
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lib/                   # Utilitaires
‚îÇ   ‚îú‚îÄ‚îÄ public/                    # Assets statiques
‚îÇ   ‚îú‚îÄ‚îÄ .env.local                 # Variables d'environnement
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

---

## **üéØ R√©capitulatif des commandes**

### **Installation compl√®te (premi√®re fois)**
```bash
# Backend
cd backend-api
npm install
cp .env.example .env  # Puis √©diter .env
npx prisma migrate dev
npx prisma generate
npx prisma db seed
node src/scripts/create-hcs-topic.ts
docker run -d --name redis -p 6379:6379 redis:latest
npm run dev

# Frontend (nouveau terminal)
cd frontend
npm install
cp .env.example .env.local  # Puis √©diter .env.local
npm run dev
```

### **D√©marrage quotidien**
```bash
# Terminal 1 : Backend
cd backend-api
npm run dev

# Terminal 2 : Frontend
cd frontend
npm run dev
```

---

## **üìö Ressources**

- **Hedera Documentation** : https://docs.hedera.com
- **Hedera Portal** : https://portal.hedera.com
- **HashScan (Testnet)** : https://hashscan.io/testnet
- **Prisma Documentation** : https://www.prisma.io/docs
- **Next.js Documentation** : https://nextjs.org/docs

---

üéâ **F√©licitations ! Votre application Sant√© K√®n√® est maintenant install√©e et fonctionnelle !**

